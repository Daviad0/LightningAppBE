<html>
    <head>
        <link rel="stylesheet" href="/css/style.css"/>
        <link rel="stylesheet" href="https://fonts.sandbox.google.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <link rel="preconnect" href="https://fonts.googleapis.com"> 
        <title>SparkClub</title>
        <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
        
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
        <style>
            .material-symbols-rounded {
                pointer-events: none;
              font-variation-settings:
              'FILL' 1,
              'wght' 500,
              'GRAD' 200,
              'opsz' 48
            }
            *{
                font-family: 'Inter', sans-serif;
            
            }

            </style>
    </head>
    <body>
        <div style="position: fixed;bottom:10px;right:20px;z-index:1000">
            <div class="container c-border-red color-r" style="padding:10px 50px 10px 50px;margin:10px;font-weight:600;display:none;opacity:0" id="errorContainer">
                Error: Not Authenticated
            </div>
        </div>
        <div class="overlay_bg" id="overlay" style="display: none;z-index:10000;position:fixed">
            <div class="container c-slightborder" style="position:fixed;width: 50%;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;padding:30px" id="overlayBigBox">
                <div id="overlayBox"></div>
                <div class="container c-border color-g c-hover" style="padding:10px 50px 10px 50px;margin:10px" id="overlay_done">
                    Done
                </div>
                <div class="container c-border-gray color-g c-hover-gray" style="padding:10px 50px 10px 50px;margin:10px" id="overlay_close">
                    Cancel
                </div>
            </div>
            
        </div>
        <div class="header">
            <div>
                <div style="height:100%;width:100%;display:flex;align-items:center;justify-content:space-between">
                    <div class="bigscreen">
                        <div style="display: inline-flex;align-items:center">
                            <img src="/images/sparkclub.png" style="width:40px;margin:0px 40px;transition:all 1s ease-in-out" class="mainlogo"/>
                        
                            <div class="a container c-border c-hover goToPage" data-page="home" style="display: inline-flex;margin:0px 10px 0px 10px;padding:10px 20px 10px 20px">
                                Home
                            </div>
                            <div class="a container c-border c-hover goToPage" data-page="signin" style="display: inline-flex;margin:0px 10px 0px 10px;padding:10px 20px 10px 20px">
                                Sign In with Student ID
                            </div>
                            <div class="a container c-border c-hover goToPage" data-page="group/accounts" style="display: none;margin:0px 10px 0px 10px;padding:10px 20px 10px 20px">
                                Accounts
                            </div>
                            <div class="a container c-border c-hover goToPage" data-page="group/manage" style="display: none;margin:0px 10px 0px 10px;padding:10px 20px 10px 20px">
                                Manage
                            </div>
                            <div class="a container c-border c-hover goToPage" data-page="group/report" style="display: none;margin:0px 10px 0px 10px;padding:10px 20px 10px 20px">
                                Logs
                            </div>
                        </div>
                    </div>
                    <div class="smallscreen">
                        <div style="display: inline-flex;align-items:center">
                            <img src="/images/sparkclub.png" style="width:40px;margin:0px 40px;transition:all 1s ease-in-out" class="mainlogo"/>
                        </div>
                    </div>
                    
                    
                    <div style="display: inline-flex;align-items:center;padding-right:30px">
                        <span style="display: inline-flex;margin:0px 20px 0px 20px;font-size:14px" class="text" id="account_username"><i>Not Signed In</i></span>
                        <div id="account_login" class="a container c-border c-hover color-m triggerDisplay" data-action="show hide hide" data-target="accountC_login accountC_me accountC_create" style="display: inline-flex;margin:0px 10px 0px 10px;padding:10px 20px 10px 20px">
                            <span class="material-symbols-rounded">login</span>
                        </div>
                        <div id="account_create" class="a container c-border c-hover color-m goToPage" data-page="create" style="margin:0px 10px 0px 10px;padding:10px 20px 10px 20px">
                            <span class="material-symbols-rounded">person_add</span>
                        </div>
                        <div id="account_me" class="a container c-border c-hover color-m triggerDisplay" data-action="show hide hide" data-target="accountC_me accountC_create accountC_login" style="display: inline-flex;margin:0px 10px 0px 10px;padding:10px 20px 10px 20px;display:none">
                            <span class="material-symbols-rounded">face</span>
                        </div>
                    </div>
                </div>
            </div>
            
            
        </div>

        <div class="container c-slightborder" style="position:absolute;top:100px;right:10px;padding:40px;text-align:center;display:none;z-index:5" id="accountC_create">
            <span class="text color-d" style="display: block;margin-bottom:10px">Create Account</span>
            
            <div>
                <div style="width:80px;display:inline-block">
                    <span class="text color-m" style="font-size:12px;font-weight:500;margin-right:5px;width:80px">Group</span>
                </div>
                <input type="text" placeholder="group123" class="input color-m" style="width:200px;margin-top:10px;border:1px solid #4708c4"/>
            </div>
            <br/>
            <div class="a container c-border c-hover goToPage triggerDisplay" data-page="create" data-action="hide" data-target="accountC_create" style="padding:10px 20px 10px 20px">
                Create
            </div>
            <div class="a container c-border-gray c-hover-gray color-g triggerDisplay" data-action="hide" data-target="accountC_create" style="padding:10px 20px 10px 20px">
                Cancel
            </div>
            
            
            
            
        </div>

        <div class="container c-slightborder" style="position:absolute;top:100px;right:10px;padding:40px;text-align:center;display:none;z-index:5" id="accountC_login">
            <span class="text color-d" style="display: block;margin-bottom:10px">Login</span>
            
            <div>
                <div style="width:200px;display:inline-block">
                    <span class="text color-d" style="font-size:12px;font-weight:500;margin-right:5px;">Username / StudentID</span>
                </div>
                <input type="text" placeholder="johndoe1" class="input color-d" id="login_username" style="width:200px;margin-top:10px"/>
            </div>
            <div>
                <div style="width:200px;display:inline-block">
                    <span class="text color-d" style="font-size:12px;font-weight:500;margin-right:5px">Password</span>
                </div>
                <input type="password" placeholder="password1" class="input color-d" id="login_password" style="width:200px;margin-top:10px"/>
            </div>
            <input type="hidden" value="lightning-robotics" class="input color-m" id="login_group" style="width:200px;margin-top:10px;border:1px solid #4708c4"/>
            <br/>
            <div class="a container c-border c-hover baseaction" data-action="login" style="padding:10px 20px 10px 20px">
                Login
            </div>
            <div class="a container c-border-gray c-hover-gray color-g triggerDisplay" data-action="hide" data-target="accountC_login" style="padding:10px 20px 10px 20px">
                Cancel
            </div>
            <br/>
            <div class="container c-border-red c-hover-red color-r" style="padding:10px 20px 10px 20px;pointer-events:all;margin-top:5px" id="accountC_forgotuser">
                Forgot my Username
            </div>
            <br/>
            <div class="container c-border-red c-hover-red color-r" style="padding:10px 20px 10px 20px;pointer-events:all;margin-top:5px" id="accountC_forgotpass">
                Forgot my Password
            </div>
            
            
            
            
        </div>

        <div class="container c-slightborder" style="position:absolute;top:100px;right:10px;padding:40px;text-align:center;display:none;z-index:5" id="accountC_me">
            <span class="text color-d" style="display: block;margin-bottom:10px" id="ca_username">[ME]</span>
            <span class="text color-d" style="display: block;margin-bottom:10px;font-size:14px" id="ca_group"><i>Part of [group]</i></span>
            
            
            <br/>
            <div class="a container c-border c-hover baseaction" data-action="account" style="padding:10px 20px 10px 20px">
                My Account
            </div>
            <div class="a container c-border-gray c-hover-gray color-g baseaction" data-action="logout" style="padding:10px 20px 10px 20px">
                Logout
            </div>
            
            
            
            
        </div>
        
        <div style="position:absolute;top: 100px;left:-10px;width:100%;text-align:center;height:80%" id="contents">

        </div>

        <div class="baseaction" data-action="none" style="display:none" id="externalClickAction"></div>
        <div class="baseaction" data-action="none" style="display:none" id="reloadBaseEvents"></div>
        <div class="baseaction" data-action="none" style="display:none" id="showErrorMessage"></div>
    </body>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qr-creator/dist/qr-creator.min.js"></script>

    <script>

        var authId = "";
        var group = "";
        var overlayData = {};
        var thisUser = undefined;

        
        document.getElementById("accountC_forgotuser").addEventListener("click", function(evt){
            document.getElementById("externalClickAction").dataset.action = "overlay";
            document.getElementById("externalClickAction").dataset.overlay = "forgot_username";
            
            document.getElementById("externalClickAction").click();
        });

        document.getElementById("accountC_forgotpass").addEventListener("click", function(evt){
            document.getElementById("externalClickAction").dataset.action = "overlay";
            document.getElementById("externalClickAction").dataset.overlay = "forgot_password";
            
            document.getElementById("externalClickAction").click();
        });

        function replace(e){
            var new_element = e.cloneNode(true);
            e.parentNode.replaceChild(new_element, e);
        }

        function load(page){
            window.history.pushState("hiya", "Club Mgmt", page);
            
            $.ajax({
                url: "/part" + page,
                headers : {partial : "YES", authorization : authId},
                success: function(data){
                    
                    $("#contents").html(data);
                    reloadAllBaseEvents();
                },
                error: function(data){
                    load("/home");
                }
            });
        }
        try{

            
            var cookies = document.cookie.split(";");
            cookies.forEach(c => {
                var parts = c.split("=");
                if(parts[0] == "session"){
                    authId = parts[1];
                    $.ajax({
                        url: "/acc/verify",
                        headers : {authorization : parts[1]},
                        success: function(data){
                            data = JSON.parse(data);
                            if(data["successful"]){
                                group = data["user"]["group"];
                                thisUser = data["user"];
                                document.getElementById("account_login").style.display = "none";
                                document.getElementById("account_create").style.display = "none";
                                document.getElementById("account_me").style.display = "";
                                document.getElementById("account_username").textContent = data["user"]["username"];
                                document.getElementById("accountC_login").style.display = "none";
                                document.getElementById("accountC_me").style.display = "none";
                                document.getElementById("accountC_create").style.display = "none";
                                document.getElementById("ca_username").textContent = data["user"]["username"];
                                document.getElementById("ca_group").textContent = "Part of " + data["user"]["group"];
                                document.querySelector('div[data-page="group/manage"]').style.display = "inline-flex";
                                document.querySelector('div[data-page="group/accounts"]').style.display = "inline-flex";
                                document.querySelector('div[data-page="signin"]').style.display = "none";
                            }
                        }
                    });
                }
            });
        }catch(e){

        }

        document.getElementById("overlay_done").addEventListener("click", function(evt){
            
            
            var sendback = document.getElementById(evt.srcElement.dataset.sendback);
            var data = "";
            switch(evt.srcElement.dataset.overlay){
                case "add_manager":
                    var username = document.getElementById("overlay_username").value;
                    var id = document.getElementById("overlay_username").dataset.id;
                    data = "user=" + username + ";id=" + id;
                    break;
                case "add_member":
                    var username = document.getElementById("overlay_username").value;
                    var id = document.getElementById("overlay_username").dataset.id;
                    data = "user=" + username + ";id=" + id;
                    break;  
                case "see_meeting":
                    var attending = [];
                    Array.from(document.getElementsByClassName("subgroup")).forEach(e => {
                        var index = e.dataset.num;
                        attending.push(overlayData["existing"][index]);
                    });
                    console.log(attending);
                    var dataObj = {
                        _id: overlayData["meeting"]["_id"],
                        title: document.getElementById("meeting_purpose").value,
                        description: document.getElementById("meeting_description").value,
                        date: document.getElementById("meeting_date").value,
                        time: document.getElementById("meeting_time").value,
                        subgroups: attending,
                        length: document.getElementById("meeting_length").value
                    }
                    data += JSON.stringify(dataObj);
                    break;
                case "edit_attendance":
                    var newOverride = document.getElementById("overlay_override").dataset.value;
                    var dataObj = {
                        uid: document.getElementById("overlay_override").dataset.uid,
                        meeting: document.getElementById("overlay_override").dataset.meeting,
                        override: newOverride
                    }
                    data += JSON.stringify(dataObj);
                    break;
                case "create_item":
                    
                    if(document.getElementById("create_title").value == "" || document.getElementById("create_contents").value){
                        document.getElementById("errormessage").innerHTML = "Please fill out the title and contents of the item.";
                        document.getElementById("errormessage").style.display = "";
                        return;
                    }
                    var dataObj = {
                        title: document.getElementById("create_title").value,
                        contents: document.getElementById("create_contents").value,
                        link: document.getElementById("create_link").value,
                        icon: document.getElementById("create_icon").value
                        
                    }
                    data += JSON.stringify(dataObj);
                    break;
                case "confirm":
                    data = overlayData["id"];
                    break;

                case "create_account":
                    document.getElementById("errormessage").style.display = "none";
                    $.post("/acc/create", {
                        username: $("#create_username").val(),
                        password: $("#create_password").val(),
                        group: "lightning-robotics",
                        email: $("#create_email").val(),
                        fullname: $("#create_fullname").val(),
                        externalId: $("#create_externalId").val()
                    }, function(data){
                        //console.log(data);
                        data = JSON.parse(data);
                        if(data["successful"] == false){
                            if(data["error"] == "username"){
                                flashFormError(6000, document.getElementById("create_username"));
                            }else if(data["error"] == "password"){
                                flashFormError(6000, document.getElementById("create_password"));
                            }else if(data["error"] == "externalId"){
                                flashFormError(6000, document.getElementById("create_externalId"));
                            }else if(data["error"] == "email"){
                                flashFormError(6000, document.getElementById("create_email"));
                            }else if(data["error"] == "fullname"){
                                flashFormError(6000, document.getElementById("create_fullname"));
                            }
                            document.getElementById("errormessage").textContent = data["message"];
                            document.getElementById("errormessage").style.display = "block";
                        }else{
                            document.getElementById('overlay').style.display = "none";
                            sendback.click();
                        }
                    });
                    return;


                    break;
                case "force_reset_password":
                    document.getElementById("errormessage").style.display = "none";

                    if(document.getElementById("new_password").value == ""){
                        document.getElementById("errormessage").innerHTML = "Passwords cannot be blank";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    if(document.getElementById("new_password").value != document.getElementById("confirm_password").value){
                        document.getElementById("errormessage").innerHTML = "Passwords do not match";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    var dataObj = {
                        id: overlayData["id"],
                        newPassword: document.getElementById("new_password").value,
                        confirmPassword: document.getElementById("confirm_password").value
                    }
                    data += JSON.stringify(dataObj);
                    break;
                case "reset_password":
                    document.getElementById("errormessage").style.display = "none";
                    if(document.getElementById("new_password").value == "" || document.getElementById("old_password").value == ""){
                        document.getElementById("errormessage").innerHTML = "Passwords cannot be blank";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    if(document.getElementById("new_password").value != document.getElementById("confirm_password").value){
                        document.getElementById("errormessage").innerHTML = "Passwords do not match";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    var dataObj = {
                        oldPassword: document.getElementById("old_password").value,
                        newPassword: document.getElementById("new_password").value,
                        confirmPassword: document.getElementById("confirm_password").value
                    }
                    data += JSON.stringify(dataObj);
                    break;
                case "reset_code":
                    document.getElementById("errormessage").style.display = "none";
                    if(document.getElementById("access_code").value == ""){
                        document.getElementById("errormessage").innerHTML = "Access Code cannot be blank";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    if(document.getElementById("access_code").dataset.uid == undefined || document.getElementById("access_code").dataset.uid == ""){
                        document.getElementById("errormessage").innerHTML = "You must reset your password properly first...";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    if(document.getElementById("access_code").value.toString().length != 6){
                        document.getElementById("errormessage").innerHTML = "Access Code must be 6 digits";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    if(document.getElementById("new_password").value == ""){
                        document.getElementById("errormessage").innerHTML = "Passwords cannot be blank";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    if(document.getElementById("new_password").value != document.getElementById("confirm_password").value){
                        document.getElementById("errormessage").innerHTML = "Passwords do not match";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    var dataObj = {
                        code: document.getElementById("access_code").value,
                        newPw: document.getElementById("new_password").value,
                        uid: document.getElementById("access_code").dataset.uid
                    }
                    $.ajax({
                        url: "/acc/reset",
                        type: "POST",
                        data: dataObj,
                        success: function(data){
                            data = JSON.parse(data);
                            if(data["successful"] == false){
                                document.getElementById("errormessage").innerHTML = "The reset was unsuccessful... Please ensure the access code is correct!";
                                document.getElementById("errormessage").style.display = "block";
                            }else{
                                
                                document.getElementById('overlay').style.display = "none";

                                document.getElementById("externalClickAction").dataset.action = "overlay";
                                document.getElementById("externalClickAction").dataset.overlay = "reset_successful";
                                
                                document.getElementById("externalClickAction").click();
                                
                            }
                        }
                    
                    })
                    return;
                    break;
                case "forgot_username":
                    document.getElementById("errormessage").style.display = "none";
                    if(document.getElementById("form_email").value == ""){
                        document.getElementById("errormessage").innerHTML = "Email cannot be blank...";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    if(!document.getElementById("form_email").value.includes("@")){
                        document.getElementById("errormessage").innerHTML = "Email must be valid...";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    $.ajax({
                        url: "/acc/forgotusername",
                        type: "POST",
                        data: {
                            email: document.getElementById("form_email").value
                        },
                        success: function(data){
                            
                        }
                    })
                    break;
                case "forgot_password":
                    document.getElementById("errormessage").style.display = "none";
                    if(document.getElementById("form_email").value == ""){
                        document.getElementById("errormessage").innerHTML = "Email cannot be blank...";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    if(!document.getElementById("form_email").value.includes("@")){
                        document.getElementById("errormessage").innerHTML = "Email must be valid...";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    if(document.getElementById("form_studentid").value == ""){
                        document.getElementById("errormessage").innerHTML = "Student ID cannot be blank...";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    if(document.getElementById("form_studentid").value.toString().length != 8){
                        document.getElementById("errormessage").innerHTML = "Student ID must be 8 digits...";
                        document.getElementById("errormessage").style.display = "block";
                        return;
                    }
                    $.ajax({
                        url: "/acc/requestcode",
                        type: "POST",
                        data: {
                            email: document.getElementById("form_email").value,
                            studentid: document.getElementById("form_studentid").value
                        },
                        success: function(data){
                            data = JSON.parse(data);
                            document.getElementById('overlay').style.display = "none";
                            if(data["successful"] == true){
                                document.getElementById("externalClickAction").dataset.action = "overlay";
                                document.getElementById("externalClickAction").dataset.overlay = "reset_code";
                                document.getElementById("externalClickAction").dataset.data = data["userId"];
                                document.getElementById("externalClickAction").click();
                            }
                            

                            
                        }
                    })
                    return;
                    break;
                case "create_meeting":
                    var attending = [];
                    Array.from(document.getElementsByClassName("subgroup")).forEach(e => {
                        var index = e.dataset.num;
                        attending.push(overlayData["existing"][index]);
                    });
                    console.log(attending);
                    var dataObj = {
                        title: document.getElementById("meeting_purpose").value,
                        description: document.getElementById("meeting_description").value,
                        date: document.getElementById("meeting_date").value,
                        time: document.getElementById("meeting_time").value,
                        subgroups: attending,
                        length: document.getElementById("meeting_length").value
                    }
                    data += JSON.stringify(dataObj);
                    console.log(data);
                    break;
            }
            document.getElementById('overlay').style.display = "none";
            if(sendback != null){
                sendback.innerHTML = data;
                sendback.click();
            }
        });
        

        document.getElementById("overlay_close").addEventListener("click", function(evt){
            document.getElementById('overlay').style.display = "none";
            
        });


        

        function reloadAllBaseEvents(){

            Array.from(document.getElementsByClassName("a")).forEach(e => {
                replace(e);
            });

            Array.from(document.getElementsByClassName("baseaction")).forEach(e => {
                e.addEventListener("click", function(evt){
                    switch(evt.srcElement.dataset.action){
                        case "login":
                            $.post("/acc/login", {
                                username: $("#login_username").val(),
                                password: $("#login_password").val(),
                                group: $("#login_group").val()
                            }, function(data){
                                //console.log(data);
                                data = JSON.parse(data);
                                if(data["successful"] == false){
                                    flashFormError(3000, document.getElementById("login_username"));
                                    flashFormError(3000, document.getElementById("login_password"));
                                    flashFormError(3000, document.getElementById("login_group"));
                                }else{
                                    thisUser = data["user"];
                                    document.cookie = "session=" + data["token"];
                                    authId = data["token"];
                                    document.getElementById("account_login").style.display = "none";
                                    document.getElementById("account_create").style.display = "none";
                                    document.getElementById("account_me").style.display = "";
                                    document.getElementById("account_username").textContent = data["user"]["username"];
                                    document.getElementById("accountC_login").style.display = "none";
                                    document.getElementById("ca_username").textContent = data["user"]["username"];
                                    document.getElementById("ca_group").textContent = "Part of " + data["user"]["group"];
                                    document.querySelector('div[data-page="group/manage"]').style.display = "inline-flex";
                                    document.querySelector('div[data-page="group/report"]').style.display = "inline-flex";
                                    document.querySelector('div[data-page="group/accounts"]').style.display = "inline-flex";
                                    document.querySelector('div[data-page="signin"]').style.display = "none";
                                    load("/home");
                                }
                            });
                            
                            break;
                        case "create":
                        document.getElementById("create_error").style.display = "none";
                        if($("#create_password").val() != $("#create_confirmPassword").val()){
                            document.getElementById("create_error").style.display = "block";
                            document.getElementById("create_error").innerHTML = "Passwords do not match";
                            flashFormError(3000, document.getElementById("create_password"));
                            flashFormError(3000, document.getElementById("create_confirm"));
                            return;
                        }
                        $.post("/acc/create", {
                            username: $("#create_username").val(),
                            password: $("#create_password").val(),
                            group: "lightning-robotics",
                            email: $("#create_email").val(),
                            fullname: $("#create_fullname").val(),
                            externalId: $("#create_externalId").val()
                        }, function(data){
                            //console.log(data);
                            data = JSON.parse(data);
                            if(data["successful"] == false){
                                if(data["error"] == "username"){
                                    flashFormError(6000, document.getElementById("create_username"));
                                }else if(data["error"] == "password"){
                                    flashFormError(6000, document.getElementById("create_password"));
                                }else if(data["error"] == "externalId"){
                                    flashFormError(6000, document.getElementById("create_externalId"));
                                }else if(data["error"] == "email"){
                                    flashFormError(6000, document.getElementById("create_email"));
                                }else if(data["error"] == "fullname"){
                                    flashFormError(6000, document.getElementById("create_fullname"));
                                }
                                document.getElementById("create_error").textContent = data["message"];
                                document.getElementById("create_error").style.display = "block";
                            }else{
                                authId = data["token"];
                                thisUser = data["user"];
                                document.cookie = "session=" + data["token"];
                                document.getElementById("account_login").style.display = "none";
                                document.getElementById("account_create").style.display = "none";
                                document.getElementById("account_me").style.display = "";
                                document.getElementById("account_username").textContent = data["user"]["username"];
                                document.getElementById("accountC_login").style.display = "none";
                                document.getElementById("ca_username").textContent = data["user"]["username"];
                                document.getElementById("ca_group").textContent = "Part of " + data["user"]["group"];
                                document.querySelector('div[data-page="group/manage"]').style.display = "inline-flex";
                                document.querySelector('div[data-page="group/report"]').style.display = "inline-flex";
                                document.querySelector('div[data-page="group/accounts"]').style.display = "inline-flex";
                                document.querySelector('div[data-page="signin"]').style.display = "none";
                                load("/home");
                            }
                        });
                            break;
                        case "account":
                            
                        
                            document.getElementById("accountC_me").style.display = "none";
                            if(thisUser != undefined){
                                load("/acc/user/" + thisUser["id"]);
                            }
                            
                            break;
                        case "logout":
                            document.cookie = "session=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                            authId = "";
                            document.getElementById("account_login").style.display = "";
                            document.getElementById("account_create").style.display = "";
                            document.getElementById("account_me").style.display = "none";
                            document.getElementById("accountC_login").style.display = "none";
                            document.getElementById("accountC_me").style.display = "none";
                            document.getElementById("account_username").innerHTML = "<i>Not Signed In</i>";
                            document.getElementById("ca_username").innerHTML = "";
                            document.getElementById("ca_group").innerHTML = "";
                            document.querySelector('div[data-page="group/manage"]').style.display = "none";
                            document.querySelector('div[data-page="group/report"]').style.display = "none";
                            document.querySelector('div[data-page="group/accounts"]').style.display = "none";
                            document.querySelector('div[data-page="signin"]').style.display = "inline-flex";
                            load("/home");
                            break;
                        case "logattendance":
                            $.ajax({
                                url: "/group/today",
                                type: "POST",
                                data: {
                                    group: group
                                },
                                headers: {authorization: authId},
                                success: function(data){
                                    console.log(data);
                                    data = JSON.parse(data);
                                    if(data["successful"] == true){
                                        load("/home");
                                    }
                                }
                            })
                            break;
                        case "overlay":
                            document.getElementById("overlay_done").dataset.overlay = evt.srcElement.dataset.overlay;
                            switch(evt.srcElement.dataset.overlay){
                                case "see_meeting":
                                    var data = JSON.parse(evt.srcElement.dataset.data);
                                    document.getElementById('overlay').style.display = "";
                                    var date = new Date(data["meeting"]["datetime"]);
                                    var s = "";
                                    
                                    document.getElementById('overlayBox').innerHTML = `
                                    <span class="text color-d" style="font-size:28px;margin:10px;display:block">Meeting #${data["number"]}</span>
                                    <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                        <div style="display:inline-block;text-align:left;margin:5px 30px">
                                            <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Purpose</span>
                                        </div>
                                        <input type="text" class="text color-d input form_name" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="${data["meeting"]["title"]}" placeholder="Party!" id="meeting_purpose">
                                    </div>
                                    <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                        <div style="display:inline-block;text-align:left;margin:5px 30px">
                                            <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Description</span>
                                        </div>
                                        <input type="text" class="text color-d input form_name" style="display:inline-block;font-size:14px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="${data["meeting"]["description"]}" placeholder="For the greatest of party attenders!" id="meeting_description">
                                    </div>
                                    <div style="display:flex;justify-content:space-around">
                                        <div>
                                            <div style="display:inline-block;text-align:left">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Date</span>
                                            </div>
                                            
                                            <input type="date" class="text color-d input form_name" style="display:inline-block;font-size:16px;margin:5px;width:200px;padding:14px;vertical-align:middle;text-align:center" value="${ date.getFullYear() + "-" + (date.getMonth()+1).toString().padStart(2, "0") + "-" + (date.getDate()).toString().padStart(2, "0")}" placeholder="Someday" id="meeting_date">
                                        </div>
                                        <div>
                                            <div style="display:inline-block;text-align:left">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Time</span>
                                            </div>
                                            <input type="time" class="text color-d input form_name" style="display:inline-block;font-size:16px;margin:5px;width:160px;padding:14px;vertical-align:middle;text-align:center" value="${(date.getHours().toString().padStart(2, "0")) + ":" + (date.getMinutes().toString().padStart(2, "0"))}" placeholder="25:00PM" id="meeting_time">
                                        </div>
                                        <div>
                                            <div style="display:inline-block;text-align:left">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Hours</span>
                                            </div>
                                            <input type="number" class="text color-d input form_name" style="display:inline-block;font-size:16px;margin:5px;width:120px;padding:14px;vertical-align:middle;text-align:center" value="${data["meeting"]["length"]}" min="0" placeholder="2h" id="meeting_length">
                                        </div>
                                    </div>
                                    
                                    <div style="margin:20px">
                                        <span class="text color-d" style="font-size:20px;margin:5px;display:block">Subgroups Attending</span>
                                        <div style="border: 2px solid #4708c4;padding:20px;margin:10px;border-radius:20px;max-height:60px;overflow-y:scroll">
                                            <div style="display:inline-block;vertical-align:middle" id="subgroups_attending">
    
                                            </div>
                                            <div class="container c-border c-hover" style="padding:5px;margin:3px;vertical-align:middle" data-partof="add_subgroup" id="subgroup_attend_add">
                                                <span class="material-symbols-rounded" style="font-size:14px;pointer-events:none">add</span>
                                                
                                                
                                            </div>
                                            
                                            
                                        </div>
                                       
                                        
                                    </div>
                                    <br/>
                                    <div class="container c-border-red color-r c-hover-red" style="padding:10px 50px 10px 50px;margin:10px" id="overlay_delete">
                                        Delete Meeting
                                    </div>
                                    `;

                                    overlayData["meeting"] = data["meeting"];
                                    
                                    overlayData["existing"] = data["meeting"]["subgroups"];

                                    function showSubgroups(){
                                        var sN = 0;
                                        document.getElementById("subgroups_attending").innerHTML = "";
                                        overlayData["existing"].forEach(m => {
                                            document.getElementById("subgroups_attending").innerHTML += `
                                            <div class="container c-border subgroup" style="padding: 5px 10px;background-color:#4708c4;display:inline-flex;align-items:center;margin:3px" data-num="${sN}">
                                                <div class="remove" style="display:inline-block" data-num="${sN}" data-id="${m}">
                                                    <span class="material-symbols-rounded color-m" style="color:white;font-size:14px;margin-right:5px" data-num="${sN}">cancel</span>
                                                    
                                                </div>
                                                
                                                <span class="color-w" style="font-size:12px">${m}</span>
                                            </div>`;
                                            sN += 1;
                                        })
                                        $.ajax({
                                            url: "/group/subgroups",
                                            success: function(data){
                                                data = JSON.parse(data);
                                                if(data["successful"]){
                                                    overlayData["subgroups"] = data["items"];
                                                    var added = 0;
                                                    document.getElementById("subgroup_attend_add").innerHTML = `<span class="material-symbols-rounded" style="font-size:14px;pointer-events:none">add</span>`;
                                                    data["items"].forEach(m => {
                                                        if(!overlayData["existing"].includes(m.name)){
                                                            document.getElementById("subgroup_attend_add").innerHTML += `<option class="dropdown_option" style="display:none" data-partof="add_subgroup" value="${m.name}">${m.name}</option>`;
                                                            added += 1;
                                                        }
                                                        
                                                    });
                                                    if(added == 0){
                                                        document.getElementById("subgroup_attend_add").style.display = "none";
                                                    }
                                                    
                                                }
    
                                            }
                                        })
                                    }
                                    document.getElementById("subgroup_attend_add").addEventListener("click", function(evt) {
                                        var partof = evt.srcElement.dataset.partof;
                                        
                                        var elementLoc = evt.srcElement.getBoundingClientRect();
                                        var documentRect = document.body.getBoundingClientRect();
                                        var existing = document.querySelector(`.dropdown_option_container[data-partof="${partof}"]`)
                                        if(existing == undefined || existing == null){
                                            var newElement = document.createElement("div");
                                            newElement.classList.add("dropdown-content");
                                            newElement.dataset.partof = partof;
                                            newElement.style.position = "absolute";
                                            newElement.style.top = elementLoc.top-90+80 + "px" + window.scrollY;
                                            newElement.style.width = "200px";
                                            
                                            newElement.dataset.normY = elementLoc.top-90+80;
                                            newElement.style.left = elementLoc.left-(documentRect.width/4)+80 + "px";
                                            
                                            newElement.style.transform = "translateX(-50%)";
                        
                                            var addHTML = "";
                                            var options = Array.from(document.querySelectorAll(`.dropdown_option[data-partof="${partof}"]`));
                        
                                            for(var i = 0; i < options.length; i++){
                                                var e = options[i];
                                                addHTML += `
                                                <div data-value="${e.value}" data-partof="${partof}" style="padding:5px 0px;width:200px;border-radius:8px;margin:2px 0px" class="dropdown_option_show transition">
                                                    ${e.innerHTML}
                                                </div>
                                                `;
                                            }
                        
                                            newElement.innerHTML = `
                                            <div class="container c-slightborder dropdown_option_container" style="width:200px;border-radius:16px" data-partof="${partof}">
                                                ${addHTML}
                                            </div>
                                            `
                                            
                                            evt.srcElement.appendChild(newElement)
                                        }else{
                                            if(evt.srcElement.classList.contains("dropdown_option_show")){
                                                console.log("AAA");
                                                var newValue = evt.srcElement.dataset.value;
                                                var newText = evt.srcElement.innerHTML;
                                                document.querySelector(`#subgroup_attend_add`).dataset.value = newValue;
                                                overlayData["existing"].push(newValue);
                                                showSubgroups();
                                                
                                            }
                                            existing.remove();
                                        }
                                    
                                    
                                    }); 
                                    showSubgroups();

                                    document.getElementById("overlay_delete").addEventListener("click", function(evt){
                                        document.getElementById("overlay").style.display = "none";
                                        document.getElementById("deleteMeeting").innerHTML = JSON.stringify(overlayData["meeting"]);
                                        document.getElementById("deleteMeeting").click();
                                    });

                                    

                                    

                                    break;
                                case "create_meeting":
                                    var data = JSON.parse(evt.srcElement.dataset.data);
                                    var s = "";
                                    document.getElementById('overlay').style.display = "";
                                    document.getElementById('overlayBox').innerHTML = `
                                    <span class="text color-d" style="font-size:28px;margin:10px;display:block">New Meeting</span>
                                    <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                        <div style="display:inline-block;text-align:left;margin:5px 30px">
                                            <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Purpose</span>
                                        </div>
                                        <input type="text" class="text color-d input form_name" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="Party!" id="meeting_purpose">
                                    </div>
                                    <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                        <div style="display:inline-block;text-align:left;margin:5px 30px">
                                            <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Description</span>
                                        </div>
                                        <input type="text" class="text color-d input form_name" style="display:inline-block;font-size:14px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="For the greatest of party attenders!" id="meeting_description">
                                    </div>
                                    <div style="display:flex;justify-content:space-around">
                                        <div>
                                            <div style="display:inline-block;text-align:left">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Date</span>
                                            </div>
                                            
                                            <input type="date" class="text color-d input form_name" style="display:inline-block;font-size:16px;margin:5px;width:200px;padding:14px;vertical-align:middle;text-align:center" value="${data["date"]}" placeholder="Someday" id="meeting_date">
                                        </div>
                                        <div>
                                            <div style="display:inline-block;text-align:left">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Time</span>
                                            </div>
                                            <input type="time" class="text color-d input form_name" style="display:inline-block;font-size:16px;margin:5px;width:160px;padding:14px;vertical-align:middle;text-align:center" value="" placeholder="25:00PM" id="meeting_time">
                                        </div>
                                        <div>
                                            <div style="display:inline-block;text-align:left">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Hours</span>
                                            </div>
                                            <input type="number" class="text color-d input form_name" style="display:inline-block;font-size:16px;margin:5px;width:120px;padding:14px;vertical-align:middle;text-align:center" value="" min="0" placeholder="2h" id="meeting_length">
                                        </div>
                                    </div>
                                    
                                    <div style="margin:20px">
                                        <span class="text color-d" style="font-size:20px;margin:5px;display:block">Subgroups Attending</span>
                                        <div style="border: 2px solid #4708c4;padding:20px;margin:10px;border-radius:20px;max-height:60px;overflow-y:scroll">
                                            <div style="display:inline-block;vertical-align:middle" id="subgroups_attending">
    
                                            </div>
                                            <div class="container c-border c-hover" style="padding:5px;margin:3px;vertical-align:middle" data-partof="add_subgroup" id="subgroup_attend_add">
                                                <span class="material-symbols-rounded" style="font-size:14px;pointer-events:none">add</span>
                                                
                                                
                                            </div>
                                            
                                            
                                        </div>
                                       
                                        
                                    </div>
                                    <br/>
                                    `;

                                    
                                    overlayData["existing"] = [];

                                    function showSubgroups(){
                                        var sN = 0;
                                        document.getElementById("subgroups_attending").innerHTML = "";
                                        overlayData["existing"].forEach(m => {
                                            document.getElementById("subgroups_attending").innerHTML += `
                                            <div class="container c-border subgroup" style="padding: 5px 10px;background-color:#4708c4;display:inline-flex;align-items:center;margin:3px" data-num="${sN}">
                                                <div class="remove" style="display:inline-block" data-num="${sN}" data-id="${m}">
                                                    <span class="material-symbols-rounded color-m" style="color:white;font-size:14px;margin-right:5px" data-num="${sN}">cancel</span>
                                                    
                                                </div>
                                                
                                                <span class="color-w" style="font-size:12px">${m}</span>
                                            </div>`;
                                            sN += 1;
                                        })
                                        $.ajax({
                                            url: "/group/subgroups",
                                            success: function(data){
                                                data = JSON.parse(data);
                                                if(data["successful"]){
                                                    overlayData["subgroups"] = data["items"];
                                                    var added = 0;
                                                    document.getElementById("subgroup_attend_add").innerHTML = `<span class="material-symbols-rounded" style="font-size:14px;pointer-events:none">add</span>`;
                                                    data["items"].forEach(m => {
                                                        if(!overlayData["existing"].includes(m.name)){
                                                            document.getElementById("subgroup_attend_add").innerHTML += `<option class="dropdown_option" style="display:none" data-partof="add_subgroup" value="${m.name}">${m.name}</option>`;
                                                            added += 1;
                                                        }
                                                        
                                                    });
                                                    if(added == 0){
                                                        document.getElementById("subgroup_attend_add").style.display = "none";
                                                    }
                                                    
                                                }
    
                                            }
                                        })
                                    }
                                    document.getElementById("subgroup_attend_add").addEventListener("click", function(evt) {
                                        var partof = evt.srcElement.dataset.partof;
                                        
                                        var elementLoc = evt.srcElement.getBoundingClientRect();
                                        var documentRect = document.body.getBoundingClientRect();
                                        var existing = document.querySelector(`.dropdown_option_container[data-partof="${partof}"]`)
                                        if(existing == undefined || existing == null){
                                            var newElement = document.createElement("div");
                                            newElement.classList.add("dropdown-content");
                                            newElement.dataset.partof = partof;
                                            newElement.style.position = "absolute";
                                            newElement.style.top = elementLoc.top-90+80 + "px" + window.scrollY;
                                            newElement.style.width = "200px";
                                            
                                            newElement.dataset.normY = elementLoc.top-90+80;
                                            newElement.style.left = elementLoc.left-(documentRect.width/4)+80 + "px";
                                            
                                            newElement.style.transform = "translateX(-50%)";
                        
                                            var addHTML = "";
                                            var options = Array.from(document.querySelectorAll(`.dropdown_option[data-partof="${partof}"]`));
                        
                                            for(var i = 0; i < options.length; i++){
                                                var e = options[i];
                                                addHTML += `
                                                <div data-value="${e.value}" data-partof="${partof}" style="padding:5px 0px;width:200px;border-radius:8px;margin:2px 0px" class="dropdown_option_show transition">
                                                    ${e.innerHTML}
                                                </div>
                                                `;
                                            }
                        
                                            newElement.innerHTML = `
                                            <div class="container c-slightborder dropdown_option_container" style="width:200px;border-radius:16px" data-partof="${partof}">
                                                ${addHTML}
                                            </div>
                                            `
                                            
                                            evt.srcElement.appendChild(newElement)
                                        }else{
                                            if(evt.srcElement.classList.contains("dropdown_option_show")){
                                                console.log("AAA");
                                                var newValue = evt.srcElement.dataset.value;
                                                var newText = evt.srcElement.innerHTML;
                                                document.querySelector(`#subgroup_attend_add`).dataset.value = newValue;
                                                overlayData["existing"].push(newValue);
                                                showSubgroups();
                                                
                                            }
                                            existing.remove();
                                        }
                                    
                                    
                                    }); 
                                    showSubgroups();


                                    

                                    

                                    break;

                                
                                case "see_protons":
                                    var data = JSON.parse(evt.srcElement.dataset.data);
                                    document.getElementById('overlay').style.display = "";


                                    var total = 0;
                                    var htmlstr = "";
                                    for(var i = 0; i < data["protonLog"].length; i++){
                                        total += data["protonLog"][i].protons;
                                        var icon = "";

                                        switch(data["protonLog"][i].message){
                                            case "REDEEM":
                                                icon = "shopping_cart";
                                                break;
                                            case "COMMEND":
                                                icon = "thumb_up";
                                                break;
                                            case "ATTEND":
                                                icon = "inventory";
                                                break;
                                            default:
                                                icon = "help";
                                                break;
                                        }

                                        htmlstr += `
                                        <div class="container c-slightborder" style="width:80%;padding:10px 20px;margin-bottom:10px">
                                            <div style="display:inline-flex;justify-content:space-between;align-items:center;width:100%">
                                                <span class="text color-${data["protonLog"][i].protons > 0 ? "d" : "r"}" style="font-size:18px;margin:10px;display:inline-flex;width:20%"><strong>${data["protonLog"][i].protons > 0 ? "+" : "-"}${Math.abs(data["protonLog"][i].protons)} </strong></span>
                                                <span class="text color-m" style="font-size:14px;margin:10px;display:inline-flex;width:40%"><i>From ${data["protonLog"][i].givenBy.toUpperCase()}</i></span>
                                                <span class="material-symbols-rounded" style="font-size:24px;pointer-events:none" title="${data["protonLog"][i].message}">${icon}</span>
                                            </div>
                                        </div>
                                        
                                        `;
                                    }

                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">${data["username"]}'s Proton Record</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block">${total} Total Protons</span>

                                        <div style="width:100%;margin:20px 0px;max-height:40vh">
                                        ${htmlstr}
                                        </div>
                                        `;

                                    overlayData["username"] = data["username"];
                                    
                                    break;
                                case "force_reset_password":
                                    var data = JSON.parse(evt.srcElement.dataset.data);
                                    document.getElementById('overlay').style.display = "";


                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">Reset ${data["username"]}'s Password</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block"><strong>WARNING: </strong>The user will not be able to access their account with their old password unless they know the new one. Please ensure you communicate the new password to them!</span>

                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">New Password</span>
                                            </div>
                                            <input type="password" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="S3cureP@ssw0rd!" id="new_password">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Confirm Password</span>
                                            </div>
                                            <input type="password" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="S3cureP@ssw0rd!" id="confirm_password">
                                        </div>
                                        <span class="text color-m" id="errormessage" style="font-size:14px;margin:10px;display:none;color:red"></span>
                                        `;
                                    overlayData["id"] = data["id"];
                                    overlayData["username"] = data["username"];
                                    
                                    break;
                                case "create_item":
                                    //var data = JSON.parse(evt.srcElement.dataset.data);
                                    document.getElementById('overlay').style.display = "";


                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">Create Item</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block">Create an item for your subgroup to show!</span>

                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Item Title</span>
                                            </div>
                                            <input type="text" class="text color-d input" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="Fun Title" id="create_title">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Item Contents</span>
                                            </div>
                                            <textarea type="text" class="text color-d input" style="display:block;font-size:16px;margin:10px;width:100%;font-weight:500;resize:none;height:100px;border-radius:30px;padding:14px" placeholder="Contents" id="create_contents"></textarea>
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Item Icon</span>
                                            </div>
                                            <input type="text" class="text color-d input" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="star" id="create_icon">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Item Link</span>
                                            </div>
                                            <input type="text" class="text color-d input" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="google.com" id="create_link">
                                        </div>
                                        
                                        
                                        <span class="text color-m" id="errormessage" style="font-size:14px;margin:10px;display:none;color:red"></span>
                                        `;
                                    //overlayData["id"] = data["id"];
                                    //overlayData["username"] = data["username"];
                                    
                                    break;
                                case "reset_successful":
                                    
                                    document.getElementById('overlay').style.display = "";


                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">Password Reset Successful</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block">Please logon with the new password that you specified! Remember, we cannot recover your password, and you must reset it again if you forget it...</span>

                                        <div class="c-border bounce" style="border-radius: 60px;border-width:4px;background-color:#4708c4;width:100px;height:100px;display:inline-block;margin:20px">
                                            <span class="material-symbols-rounded color-w" style="width:50%;margin-top:20%;font-size:56px">check</span>
                                        </div>

                                        <span class="text color-m" id="errormessage" style="font-size:14px;margin:10px;display:none;color:red"></span>
                                        `;
                                    
                                    
                                    break;
                                case "reset_password":
                                    var data = JSON.parse(evt.srcElement.dataset.data);
                                    document.getElementById('overlay').style.display = "";


                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">Reset Your Password</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block"><strong>WARNING: </strong>You will not be able to access your account using your old password after changing it. Once you reset your password, there is no way to read it again in plaintext, and you must contact an Administrator if it is lost.</span>

                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Current Password</span>
                                            </div>
                                            <input type="password" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="My0ldP@ssword..." id="old_password">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">New Password</span>
                                            </div>
                                            <input type="password" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="S3cureP@ssw0rd!" id="new_password">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Confirm Password</span>
                                            </div>
                                            <input type="password" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="S3cureP@ssw0rd!" id="confirm_password">
                                        </div>
                                        <span class="text color-m" id="errormessage" style="font-size:14px;margin:10px;display:none;color:red"></span>
                                        `;
                                    
                                    
                                    break;
                                case "reset_code":
                                    var uid = evt.srcElement.dataset.data;
                                    document.getElementById('overlay').style.display = "";


                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">Use Password Reset Code</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block"><strong>WARNING: </strong>You will not be able to access your account using your old password after changing it. Once you reset your password, there is no way to read it again in plaintext, and you must contact an Administrator if it is lost.</span>

                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Access Code</span>
                                            </div>
                                            <input type="number" class="text color-d input form_accesscode" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="123456" id="access_code" data-uid="${uid}">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">New Password</span>
                                            </div>
                                            <input type="password" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="S3cureP@ssw0rd!" id="new_password">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Confirm Password</span>
                                            </div>
                                            <input type="password" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="S3cureP@ssw0rd!" id="confirm_password">
                                        </div>
                                        <span class="text color-m" id="errormessage" style="font-size:14px;margin:10px;display:none;color:red"></span>
                                        `;
                                    
                                    
                                    break;
                                case "create_account":
                                    
                                    document.getElementById('overlay').style.display = "";


                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">Create User Account</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block"><strong>WARNING: </strong>Please notify the user of their password, or else you must reset it afterwards!</span>

                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Full Name</span>
                                            </div>
                                            <input type="text" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="John Doe" id="create_fullname">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Username</span>
                                            </div>
                                            <input type="text" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="JhonnyDoe" id="create_username">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Email</span>
                                            </div>
                                            <input type="text" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="john@doe.com" id="create_email">
                                        </div>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block">Please enter in the user's student ID</span>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">External ID</span>
                                            </div>
                                            <input type="text" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="20070000" id="create_externalId">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Password</span>
                                            </div>
                                            <input type="password" class="text color-d input form_password" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="S3cureP@ssw0rd!" id="create_password">
                                        </div>
                                        <span class="text color-m" id="errormessage" style="font-size:14px;margin:10px;display:none;color:red"></span>
                                        `;
                                    
                                    
                                    break;
                                case "confirm":
                                    var data = JSON.parse(evt.srcElement.dataset.data);
                                    document.getElementById('overlay').style.display = "";


                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">${data["title"]}</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block"><strong>WARNING: </strong>${data["message"]}</span>
                                        `;
                                    overlayData["id"] = data["id"];
                                    
                                    break;
                                case "add_protons":
                                    var data = JSON.parse(evt.srcElement.dataset.data);
                                    document.getElementById('overlay').style.display = "";


                                    var total = 0;

                                    for(var i = 0; i < data["protonLog"].length; i++){
                                        total += data["protonLog"][i].protons;
                                        
                                    }

                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">Add Proton Record for ${data["username"]}</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block">They currently have ${total} protons</span>

                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Number of Protons</span>
                                            </div>
                                            <input type="number" class="text color-d input form_protons" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="100" id="protons_number">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;"><u title="Specific Reasons:\n\nREDEEM: For redeeming points\nCOMMEND: To commend the user for work\nATTEND: For user's nonlogged attendance\nOtherwise, put something custom!">Message</u></span>
                                            </div>
                                            <input type="text" class="text color-d input form_reason" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="For being a valuable member to the team!" id="protons_message">
                                        </div>
                                        `;

                                    overlayData["username"] = data["username"];
                                    
                                    break;
                                case "forgot_username":
                                    
                                    document.getElementById('overlay').style.display = "";


                                    

                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">Forgot My Username</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block">It's alright, we all forget something all the time! Please type your email that you created the account with, and you will get an email from our service with your username in it! If you have any further issues, please see team leadership. <strong>Please note that we CANNOT recover passwords, and we will have to reset it if you do not remember...</strong></span>

                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Your Email</span>
                                            </div>
                                            <input type="text" class="text color-d input form_email" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="john@doe.com" id="form_email">
                                        </div>
                                        <span class="text color-m" id="errormessage" style="font-size:14px;margin:10px;display:none;color:red"></span>
                                        `;

                                    
                                    
                                    break;
                                case "forgot_password":
                                    
                                    document.getElementById('overlay').style.display = "";


                                    

                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">Forgot My Password</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block">Please verify this information, and then you will be sent a code which you can use to reset your password!</span>

                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Your Email</span>
                                            </div>
                                            <input type="text" class="text color-d input form_email" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="john@doe.com" id="form_email">
                                        </div>
                                        <div style="width:100%;display:flex;justify-content:space-around;align-items:center">
                                            <div style="display:inline-block;text-align:left;margin:5px 30px">
                                                <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">Student ID</span>
                                            </div>
                                            <input type="number" class="text color-d input form_studentid" style="display:inline-block;font-size:16px;margin:5px;padding:14px;vertical-align:middle;text-align:center;width:60%" value="" placeholder="00000000" id="form_studentid">
                                        </div>
                                        <span class="text color-m" id="errormessage" style="font-size:14px;margin:10px;display:none;color:red"></span>
                                        `;

                                    
                                    
                                    break;
                                case "edit_attendance":
                                    var data = JSON.parse(evt.srcElement.dataset.data);
                                    document.getElementById('overlay').style.display = "";

                                    

                                    
                                    

                                    var userReport = data.user.attendance.find(a => a.event == data.meeting._id);
                                    var status = userReport == undefined ? "ABSENT" : userReport.status;

                                    if(status == "ABSENT"){
                                        var done = false;
                                        for(var i = 0; i < data.meeting.subgroups.length; i++){
                                            for(var j = 0; j < data.user.access.groups.length; j++){
                                                
                                                if(data.meeting.subgroups[i] == data.user.access.groups[j]){
                                                    done = true;
                                                    break;
                                                }
                                            }
                                        }
                                        if(!done){
                                            status = "EXCUSED";
                                        }
                                    }
                                    var date = new Date(data.meeting.datetime);
                                    date = date.toLocaleDateString("en-US", {month: "short", day: "numeric", year: "numeric"});
                                    document.getElementById('overlayBox').innerHTML = `
                                        <span class="text color-d" style="font-size:28px;margin:10px;display:block">Edit Attendance for ${data.user.username}</span>
                                        <span class="text color-m" style="font-size:14px;margin:10px;display:block">Meeting on ${date}</span>

                                        <div style="margin:20px">
                                            <span style="pointer-events: none;display:block"><div style="padding:5px 8px;background-color:${status == "ATTEND" ? "#23cc39" : (status == "ABSENT" ? "#ff413b": "gray")};border-radius:4px;display:inline-block;color:white">${status}</div> originally reported by user</span>
                                        </div>
                                        <div style="display:flex;justify-content:center;align-items:center;width:100%;margin:20px 0px">
                                            <span class="text color-d" style="font-size:14px;font-weight:500;margin-right:5px;">They actually (were) </span>
                                            <div id="overlay_override" class="container c-border dropdown" data-partof="dropdown_attend" style="cursor:pointer;style="display:inline-block;vertical-align:middle" data-uid="${data.user.id}" data-meeting="${data.meeting._id}" data-value="${userReport == undefined ? "" : userReport.overriddenstatus}">
                                                <span class="dropdown_text" style="float:left;margin-right:20px;opacity:0.5;margin-left:5px;pointer-events:none" data-partof="dropdown_attend">Override Option</span>
                                                <span class="material-symbols-rounded color-d dropdown_icon" style="float:right;font-size:20px" data-partof="dropdown_attend">expand_more</span>
                                                <option class="dropdown_option" style="display:none" data-partof="dropdown_attend" value="ATTEND">Attended</option>
                                                <option class="dropdown_option" style="display:none" data-partof="dropdown_attend" value="ABSENT">Absent</option>
                                                <option class="dropdown_option" style="display:none" data-partof="dropdown_attend" value="EXCUSED">Excused</option>
                                                
                                            </div>
                                        </div>
                                        `;

                                        Array.from(document.getElementsByClassName("dropdown")).forEach(e => {

                                            var val = e.dataset.value;
                                            var partof = e.dataset.partof;
                                            if(val != undefined && val != null && val != ""){
                                                var option = e.querySelector(`.dropdown_option[data-partof="${partof}"][value="${val}"]`);
                                                if(option != undefined && option != null){
                                                    document.querySelector(`.dropdown_text[data-partof="${partof}"]`).innerHTML = option.innerHTML;
                                                    document.querySelector(`.dropdown_text[data-partof="${partof}"]`).style.opacity = 1;
                                                }
                                            }
                
                                            e.addEventListener("click", function(evt){
                                                var partof = evt.srcElement.dataset.partof;
                                                
                                                var elementLoc = evt.srcElement.getBoundingClientRect();
                                                var documentRect = document.body.getBoundingClientRect();
                                                var existing = document.querySelector(`.dropdown_option_container[data-partof="${partof}"]`)
                                                if(existing == undefined || existing == null){
                                                    var newElement = document.createElement("div");
                                                    newElement.classList.add("dropdown-content");
                                                    newElement.dataset.partof = partof;
                                                    newElement.style.position = "absolute";
                                                    newElement.style.top = elementLoc.top-90+80 + "px" + window.scrollY;
                                                    newElement.dataset.normY = elementLoc.top-90+80;
                                                    newElement.style.left = elementLoc.left-(elementLoc.width/2)-60 + "px";
                                                    
                                                    newElement.style.transform = "translateX(-50%)";
                
                                                    var addHTML = "";
                                                    var options = Array.from(document.querySelectorAll(`.dropdown_option[data-partof="${partof}"]`));
                
                                                    for(var i = 0; i < options.length; i++){
                                                        var e = options[i];
                                                        addHTML += `
                                                        <div data-value="${e.value}" data-partof="${partof}" style="padding:5px 0px;width:100%;border-radius:8px;margin:2px 0px" class="dropdown_option_show transition">
                                                            ${e.innerHTML}
                                                        </div>
                                                        `;
                                                    }
                
                                                    newElement.innerHTML = `
                                                    <div class="container c-slightborder dropdown_option_container" style="width:${(elementLoc.width-20) + "px"};border-radius:16px" data-partof="${partof}">
                                                        ${addHTML}
                                                    </div>
                                                    `
                                                    
                                                    evt.srcElement.appendChild(newElement)
                                                }else{
                                                    if(evt.srcElement.classList.contains("dropdown_option_show")){
                                                        console.log("AAA");
                                                        var newValue = evt.srcElement.dataset.value;
                                                        var newText = evt.srcElement.innerHTML;
                                                        document.querySelector(`.dropdown[data-partof="${partof}"]`).dataset.value = newValue;
                                                        document.querySelector(`.dropdown_text[data-partof="${partof}"]`).innerHTML = newText;
                                                        document.querySelector(`.dropdown_text[data-partof="${partof}"]`).style.opacity = "1";
                                                    }
                                                    existing.remove();
                                                }
                                            
                                                
                                            });
                                        });

                                    
                                    
                                    break;
                                case "add_manager":
                                    function handleAddManager(evt){
                                        var oldContent = document.querySelector(".overlay_usernameComplete");
                                        if(oldContent != null){
                                            oldContent.remove();
                                        }
                                        var newElement = document.createElement("div");
                                        var elementLoc = evt.srcElement.getBoundingClientRect();
                                        var documentRect = document.body.getBoundingClientRect();
                                        newElement.classList.add("dropdown-content");
                                        newElement.classList.add("overlay_usernameComplete");
                                        newElement.style.position = "absolute";
                                        newElement.style.zIndex = "200";
                                        newElement.style.top = elementLoc.top-90+80 + "px" + window.scrollY;
                                        newElement.dataset.normY = elementLoc.top-90+80;
                                        newElement.style.left = elementLoc.left-(elementLoc.width/2)+10 + "px";
                                        
                                        newElement.style.transform = "translateX(-50%)";
                                        var addHTML = "";
                                        var useUsers = overlayData["users"].filter(u => u["username"].toLowerCase().includes(evt.srcElement.value.toLowerCase()));
                                        useUsers.sort((a, b) => {
                                            if(a["username"].toLowerCase() < b["username"].toLowerCase()){
                                                return -1;
                                            }else if(a["username"].toLowerCase() > b["username"].toLowerCase()){
                                                return 1;
                                            }else{
                                                return 0;
                                            }
                                        });
                                        for(var i = 0; i < (useUsers.length > 5 ? 5 : useUsers.length); i++){
                                            var e = useUsers[i];
                                            addHTML += `
                                            <div data-value="${e.id}" data-username="${e.username}" style="padding:5px 0px;width:100%;border-radius:8px;margin:2px 0px;cursor:pointer" class="dropdown_option_show overlay_username_item transition">
                                                ${e.username}
                                            </div>
                                            `;
                                        }
                                        newElement.innerHTML = `
                                        <div class="container c-slightborder dropdown_option_container" style="width:${(elementLoc.width-20) + "px"};border-radius:16px">
                                            ${addHTML}
                                        </div>
                                        `
                                        
                                        document.getElementById("place_suggestion").appendChild(newElement)

                                        Array.from(document.getElementsByClassName("overlay_username_item")).forEach(function(e){
                                            e.addEventListener("click", function(evt){
                                                var id = evt.srcElement.dataset.value;
                                                var name = evt.srcElement.dataset.username;

                                                document.getElementById("overlay_username").value = name;
                                                document.getElementById("overlay_username").dataset.id = id;
                                                var oldContent = document.querySelector(".overlay_usernameComplete");
                                                if(oldContent != null){
                                                    oldContent.remove();
                                                }
                                                document.getElementById("overlay_done").style.opacity = "1";
                                                document.getElementById("overlay_done").style.pointerEvents = "";
                                                document.getElementById("overlay_done").style.cursor = "pointer";

                                            })
                                        })
                                    }
                                    $.ajax({
                                        url : "/group/users",
                                        type : "GET",
                                        success: function(data){
                                            data = JSON.parse(data);
                                            if(data["successful"]){
                                                overlayData["users"] = data["items"];
                                                document.getElementById("overlay_done").style.opacity = "0.5";
                                                document.getElementById("overlay_done").style.pointerEvents = "none";
                                                document.getElementById("overlay_done").style.cursor = "not-allowed";
                                                document.getElementById('overlay').style.display = "";
                                                document.getElementById("overlay_done").dataset.sendback = "overlayRes_add_manager";
                                                document.getElementById('overlayBox').innerHTML = `
                                                <span class="text color-d" style="font-size:28px;margin:10px">Add a Subgroup Manager</span>
                                                <div style="margin:20px" id="place_suggestion">
                                                    <input class="input" type="text" placeholder="Type a Username" style="width:50%;font-size:16px" id="overlay_username"/>
                                                </div>
                                                
                                                `;
                                                document.getElementById("overlay_username").addEventListener("change", function(evt){
                                                    handleAddManager(evt);
                                                    

                                                });
                                                document.getElementById("overlay_username").addEventListener("keyup", function(evt){
                                                    handleAddManager(evt);
                                                    document.getElementById("overlay_done").style.opacity = "0.5";
                                                    document.getElementById("overlay_done").style.pointerEvents = "none";
                                                    document.getElementById("overlay_done").style.cursor = "not-allowed";
                                                });
                                                document.getElementById("overlay_username").addEventListener("click", function(evt){
                                                    handleAddManager(evt);
                                                    
                                                });
                                                document.getElementById("overlay_username").addEventListener("focusout", function(evt){
                                                    setTimeout(function(){
                                                        var oldContent = document.querySelector(".overlay_usernameComplete");
                                                        if(oldContent != null){
                                                            oldContent.remove();
                                                        }
                                                    },500);
                                                    
                                                })
                                            }
                                        }
                                    })
                                    
                                    break;
                                case "add_member":
                                    function handleAddManager(evt){
                                        var oldContent = document.querySelector(".overlay_usernameComplete");
                                        if(oldContent != null){
                                            oldContent.remove();
                                        }
                                        var newElement = document.createElement("div");
                                        var elementLoc = evt.srcElement.getBoundingClientRect();
                                        var documentRect = document.body.getBoundingClientRect();
                                        newElement.classList.add("dropdown-content");
                                        newElement.classList.add("overlay_usernameComplete");
                                        newElement.style.position = "absolute";
                                        newElement.style.zIndex = "200";
                                        newElement.style.top = elementLoc.top-90+80 + "px" + window.scrollY;
                                        newElement.dataset.normY = elementLoc.top-90+80;
                                        newElement.style.left = elementLoc.left-(elementLoc.width/2)+10 + "px";
                                        
                                        newElement.style.transform = "translateX(-50%)";
                                        var addHTML = "";
                                        var useUsers = overlayData["users"].filter(u => u["username"].toLowerCase().includes(evt.srcElement.value.toLowerCase()));
                                        useUsers.sort((a, b) => {
                                            if(a["username"].toLowerCase() < b["username"].toLowerCase()){
                                                return -1;
                                            }else if(a["username"].toLowerCase() > b["username"].toLowerCase()){
                                                return 1;
                                            }else{
                                                return 0;
                                            }
                                        });
                                        for(var i = 0; i < (useUsers.length > 5 ? 5 : useUsers.length); i++){
                                            var e = useUsers[i];
                                            addHTML += `
                                            <div data-value="${e.id}" data-username="${e.username}" style="padding:5px 0px;width:100%;border-radius:8px;margin:2px 0px;cursor:pointer" class="dropdown_option_show overlay_username_item transition">
                                                ${e.username}
                                            </div>
                                            `;
                                        }
                                        newElement.innerHTML = `
                                        <div class="container c-slightborder dropdown_option_container" style="width:${(elementLoc.width-20) + "px"};border-radius:16px">
                                            ${addHTML}
                                        </div>
                                        `
                                        
                                        document.getElementById("place_suggestion").appendChild(newElement)

                                        Array.from(document.getElementsByClassName("overlay_username_item")).forEach(function(e){
                                            e.addEventListener("click", function(evt){
                                                var id = evt.srcElement.dataset.value;
                                                var name = evt.srcElement.dataset.username;

                                                document.getElementById("overlay_username").value = name;
                                                document.getElementById("overlay_username").dataset.id = id;
                                                var oldContent = document.querySelector(".overlay_usernameComplete");
                                                if(oldContent != null){
                                                    oldContent.remove();
                                                }
                                                document.getElementById("overlay_done").style.opacity = "1";
                                                document.getElementById("overlay_done").style.pointerEvents = "";
                                                document.getElementById("overlay_done").style.cursor = "pointer";

                                            })
                                        })
                                    }
                                    $.ajax({
                                        url : "/group/users",
                                        type : "GET",
                                        success: function(data){
                                            data = JSON.parse(data);
                                            if(data["successful"]){
                                                overlayData["users"] = data["items"];
                                                document.getElementById("overlay_done").style.opacity = "0.5";
                                                document.getElementById("overlay_done").style.pointerEvents = "none";
                                                document.getElementById("overlay_done").style.cursor = "not-allowed";
                                                document.getElementById('overlay').style.display = "";
                                                document.getElementById("overlay_done").dataset.sendback = "overlayRes_add_member";
                                                document.getElementById('overlayBox').innerHTML = `
                                                <span class="text color-d" style="font-size:28px;margin:10px">Add Subgroup Member</span>
                                                <div style="margin:20px" id="place_suggestion">
                                                    <input class="input" type="text" placeholder="Type a Username" style="width:50%;font-size:16px" id="overlay_username"/>
                                                </div>
                                                
                                                `;
                                                document.getElementById("overlay_username").addEventListener("change", function(evt){
                                                    handleAddManager(evt);
                                                    

                                                });
                                                document.getElementById("overlay_username").addEventListener("keyup", function(evt){
                                                    handleAddManager(evt);
                                                    document.getElementById("overlay_done").style.opacity = "0.5";
                                                    document.getElementById("overlay_done").style.pointerEvents = "none";
                                                    document.getElementById("overlay_done").style.cursor = "not-allowed";
                                                });
                                                document.getElementById("overlay_username").addEventListener("click", function(evt){
                                                    handleAddManager(evt);
                                                    
                                                });
                                                document.getElementById("overlay_username").addEventListener("focusout", function(evt){
                                                    setTimeout(function(){
                                                        var oldContent = document.querySelector(".overlay_usernameComplete");
                                                        if(oldContent != null){
                                                            oldContent.remove();
                                                        }
                                                    },500);
                                                    
                                                })
                                            }
                                        }
                                    })
                                    
                                    break;
                                
                            }
                            break;
                    }
                });
            });

            
            
    
            Array.from(document.getElementsByClassName("goToPage")).forEach(e => {
                
                e.addEventListener("click", function(evt){
                    load("/" + evt.srcElement.dataset.page);
                });
            });

            
    
            Array.from(document.getElementsByClassName("triggerDisplay")).forEach(e => {
                e.addEventListener("click", (evt) => {
                    var action = evt.srcElement.dataset.action.split(" ");
                    var targets = evt.srcElement.dataset.target.split(" ");
    
                    for(var i = 0; i < action.length; i++) {
                        if(action[i] == "show") {
                            if(document.getElementById(targets[i]).style.display == "block"){
                                document.getElementById(targets[i]).style.display = "none";
                            }else{
                                document.getElementById(targets[i]).style.display = "block";
                            }
                            
                        } else if(action[i] == "hide") {
                            document.getElementById(targets[i]).style.display = "none";
                        }
                    }
                });
            })
            Array.from(document.getElementsByClassName("bounce")).forEach(e => {
                e.addEventListener("click", function() {
                    if(!e.classList.contains("bounce-on")){
                        e.classList.add("bounce-on");
                        setTimeout(function() {
                            e.classList.remove("bounce-on");
                        }, 600);
                    }
                    
                });
            });
        }


        

        Array.from(document.getElementsByClassName("mainlogo")).forEach(e => {
            e.addEventListener("click", function(evt) {
                evt.srcElement.classList.add("logospin");
                setTimeout(function(){
                    evt.srcElement.classList.remove("logospin");
                },500);
            });
        })

        $(document).ready(function(){
            reloadAllBaseEvents();
            let loc = window.location.pathname;
            let cookies = document.cookie.split(";");
            cookies.forEach(e => {
                if(e.split("=")[0] == "ql"){
                    var toGoTo = e.split("=")[1];
                    document.cookie = "ql=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                    window.location = toGoTo;
                    return;
                }
            });
            if(loc == "" || loc == "/" || loc == undefined){
                loc = "/home";
            }
            load(loc);
        });

        function flashFormError(timeout, element){
            element.style.borderColor = "#ff0000";
            element.style.color = "#ff0000";
            setTimeout(function(){
                element.style.borderColor = "";
                element.style.color = "";
            },timeout);
        }
        document.getElementById("showErrorMessage").addEventListener("click", function(evt){
            var el = document.getElementById("errorContainer");
            el.style.display = "";
            setTimeout(function(){
                el.style.opacity = "1";
            },10);
        });
        document.getElementById("reloadBaseEvents").addEventListener("click", function(evt){
            reloadAllBaseEvents();
        })

        
    </script>
</html>